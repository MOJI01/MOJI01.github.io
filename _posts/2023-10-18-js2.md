---
layout: post
title: js逆向-AST抽象语法树
subtitle: Let's start learning!
tags: [study]
author: Sine
---



# AST的基本认识

**抽象语法树（abstract syntax tree，AST）** 是源代码的抽象语法结构的树状表示，树上的每个节点都表示源代码中的一种结构，这所以说是抽象的，是因为抽象语法树并不会表示出真实语法出现的每一个细节，比如说，嵌套括号被隐含在树的结构中，并没有以节点的形式呈现。 抽象语法树并不依赖于源语言的语法，也就是说语法分析阶段所采用的上下文无文文法，因为在写文法时，经常会对文法进行等价的转换（消除左递归，回溯，二义性等），这样会给文法分析引入一些多余的成分，对后续阶段造成不利影响，甚至会使合个阶段变得混乱。因些，很多编译器经常要独立地构造语法分析树，为前端，后端建立一个清晰的接口。 抽象语法树在很多领域有广泛的应用，比如浏览器，智能编辑器，编译器。语法树不是某一种编程语言独有的，JavaScript、Python、Java、Golang 等几乎所有编程语言都有语法树。

简单来看一句js代码生成的语法树

```javascript
var a=1;
```

生成的语法树如下，对语法树进行分析，`var a=1；`被解析为一个变量声明VariableDeclarator，id为一个标识符Identifier，名字为a，初始化为一个数字型的字面量NumericLiteral，值为1

![image-20231021114512864](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310211145005.png)

上述的VariableDeclarator、Identifier等都为语法树的节点，当然节点还有很多

| 序号 | 类型原名称           | 中文名称      | 描述                                                  |
| ---- | -------------------- | ------------- | ----------------------------------------------------- |
| 1    | Program              | 程序主体      | 整段代码的主体                                        |
| 2    | VariableDeclaration  | 变量声明      | 声明一个变量，例如 var let const                      |
| 3    | FunctionDeclaration  | 函数声明      | 声明一个函数，例如 function                           |
| 4    | ExpressionStatement  | 表达式语句    | 通常是调用一个函数，例如 console.log()                |
| 5    | BlockStatement       | 块语句        | 包裹在 {} 块内的代码，例如 if (condition){var a = 1;} |
| 6    | BreakStatement       | 中断语句      | 通常指 break                                          |
| 7    | ContinueStatement    | 持续语句      | 通常指 continue                                       |
| 8    | ReturnStatement      | 返回语句      | 通常指 return                                         |
| 9    | SwitchStatement      | Switch 语句   | 通常指 Switch Case 语句中的 Switch                    |
| 10   | IfStatement          | If 控制流语句 | 控制流语句，通常指 if(condition){}else{}              |
| 11   | Identifier           | 标识符        | 标识，例如声明变量时 var identi = 5 中的 identi       |
| 12   | CallExpression       | 调用表达式    | 通常指调用一个函数，例如 console.log()                |
| 13   | BinaryExpression     | 二进制表达式  | 通常指运算，例如 1+2                                  |
| 14   | MemberExpression     | 成员表达式    | 通常指调用对象的成员，例如 console 对象的 log 成员    |
| 15   | ArrayExpression      | 数组表达式    | 通常指一个数组，例如 [1, 3, 5]                        |
| 16   | NewExpression        | New 表达式    | 通常指使用 New 关键词                                 |
| 17   | AssignmentExpression | 赋值表达式    | 通常指将函数的返回值赋值给变量                        |
| 18   | UpdateExpression     | 更新表达式    | 通常指更新成员值，例如 i++                            |
| 19   | Literal              | 字面量        | 通常指字符串型的字面量                                |
| 20   | BooleanLiteral       | 布尔型字面量  | 布尔值，例如 true false                               |
| 21   | NumericLiteral       | 数字型字面量  | 数字，例如 100                                        |
| 22   | StringLiteral        | 字符型字面量  | 字符串，例如 vansenb                                  |
| 23   | SwitchCase           | Case 语句     | 通常指 Switch 语句中的 Case                           |

# @Babel

Babel 是一个 JavaScript 编译器，也可以说是一个解析库，Babel 内置了很多分析 JavaScript 代码的方法，我们可以利用 Babel 将 JavaScript 代码转换成 AST 语法树，然后增删改查等操作之后，再转换成 JavaScript 代码。

## @babel/parser

将 JavaScript 代码解析成 AST 语法树

`parser.parse(code, [options]）`解析一段 JavaScript 代码

部分可选参数如下：

| 参数                          | 描述                                                         |
| :---------------------------- | :----------------------------------------------------------- |
| `allowImportExportEverywhere`‍‍‍‍ | 默认 import 和 export 声明语句只能出现在程序的最顶层，设置为 true 则在任何地方都可以声明 |
| allowReturnOutsideFunction    | 默认如果在顶层中使用 return 语句会引起错误，设置为 true 就不会报错 |
| sourceType                    | 默认为 script，当代码中含有 import 、export 等关键字时会报错，需要指定为 module |
| errorRecovery                 | 默认如果 babel 发现一些不正常的代码就会抛出错误，设置为 true 则会在保存解析错误的同时继续解析代码，错误的记录将被保存在最终生成的 AST 的 errors 属性中，当然如果遇到严重的错误，依然会终止解析`` |

举例：parser.parse()中可以加可选参数也可以不加，根据解密需要，ast为转化成的ast语法树

```javascript
const parser=require('@babel/parser'); //用于JS到AST
code="var a=1;"
let ast = parser.parse(code);
```

## @babel/generator

`@babel/generator` 可以将 AST 还原成 JavaScript 代码，提供了一个 `generate` 方法：`generate(ast, [{options}], code)`。

部分可选参数 `options`：

| 参数                   | 描述                                     |
| :--------------------- | :--------------------------------------- |
| auxiliaryCommentBefore | 在输出文件内容的头部添加注释块文字       |
| auxiliaryCommentAfter  | 在输出文件内容的末尾添加注释块文字       |
| comments               | 输出内容是否包含注释                     |
| compact                | 输出内容是否不添加空格，避免格式化       |
| concise                | 输出内容是否减少空格使其更紧凑一些       |
| minified               | 是否压缩输出代码                         |
| retainLines            | 尝试在输出代码中使用与源代码中相同的行号 |

举例：同上面一致，也是先导入，在调用；得到由ast转换成js代码的result

```javascript
const parser=require('@babel/parser'); //用于JS到AST
const generator = require("@babel/generator").default;//用户ast到js
code="var a=1;"
let ast = parser.parse(code,);
let result = generator(ast).code
```

## @babel/traverse

对于相同类型的节点，我们可以直接遍历所有节点来进行修改，这里就用到了 `@babel/traverse`

对AST语法中给特定的节点进行操作 进入节点（enter） 退出节点（enter）

```javascript
const parser=require('@babel/parser'); //用于JS到AST
const generator = require("@babel/generator").default;//用户ast到js
const traverse = require("@babel/traverse").default

code="var a=1;"
let ast = parser.parse(code,);
console.log(ast)
traverse(ast,{
    NumericLiteral:function(path){ //当进入这个Node的时候，开始执行以下代码
        console.log(path.node.value) //打印出节点的值
        path.node.value=2
    }
})
let result = generator(ast).code
console.log(result)

```

在进入`NumericLiteral`节点之后打印出值为1，进行修改`path.node.value=2`，再讲ast转化回js后发现a的值成功被修改为2

![](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310211259654.png)

当然还有很多种写法，再举例其中一种

```javascript
const visitor={
    CallExpression(path){
    	console.log("123")
    }
}
traverse(ast,visitor)
```

## @babel/types

`@babel/types` 主要用于手动构建 AST 和检查 AST 节点类型，需要结合场景进行使用



```javascript
const parser=require('@babel/parser'); //用于JS到AST
const generator = require("@babel/generator").default;//用户ast到js
const traverse = require("@babel/traverse").default
const types = require("@babel/types");

code="var a=1;"
let ast = parser.parse(code,);
console.log(ast)
// traverse(ast,{
//     NumericLiteral:function(path){ //当进入这个Node的时候，开始执行以下代码
//         console.log(path.node.value) //打印出节点类型
//         path.node.value=2
//     }
// })
const visitor = {
    VariableDeclaration(path) {
        let init = types.NumericLiteral(5)
        let declarator = types.variableDeclarator(types.identifier("b"), init)
        let declaration = types.variableDeclaration("var", [declarator])
        path.insertAfter(declaration)
        path.stop()
    }
}
traverse(ast,visitor)
let result = generator(ast).code
console.log(result)
```

成功新增节点VariableDeclaration

![image-20231021131728988](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310211317050.png)

# AST还原sojson混淆

将一段代码进行sojson混淆，得到如下

```javascript
;var encode_version = 'jsjiami.com.v5'
  , eudlm = '__0x108392'
  , __0x108392 = ['wrN5JA==', 'FCzCumooasOSwp0Mwq7DqMKzwqU=', 'wqhSwprDulg=', 'w7PClkvDscKI', 'w6F8w5DCjwU=', 'wp4Rw4I=', 'LiLCjh/Dpg==', 'w4cteG3DtA==', 'TcOHw54vwrQ=', 'IMKqWsOew4s=', 'wq3CsQF5wrQ=', 'wrIzZMKKw4k=', 'wq8hEcO5wo4=', 'TlwVwqUr', 'w4w/w5oWJQ==', 'wqrDjSTDgMKY', 'LMOkbSdk', 'wr5PwrnCiVc=', 'XcOMw5YQwrFzw54=', 'KlYiw4LDgQ==', 'YBXCsULDkA==', 'XMKbwrvDlgg=', 'wpd4PSfDoMKyfA==', 'w45Rw6zDl3rCr8K+TmvDiMK7X8KzbWrCgzY=', 'w5cpw5EXEA==', 'w7XCv8OZwrDDpA==', 'wp8AMcO+woQ=', 'wpFlITvDvQ==', 'wrECwrI=', 'w54mWXvClGNMF1A=', 'VEcnwrM=', 'woJfwr/DiCg=', 'wowEIcOl', 'wrjDmQjCswg=', 'QR0wbDE=', 'Jyw4wqLDrg==', 'w4PCusOMwozDvA==', 'wr4ww75/w64=', 'DkfCngQyLRA=', 'wr/CsQltworDhgPDhMKA', 'w7QUw78=', 'wqvDhTHCsT8fVg==', 'ZcK0wrrDjA==', 'w4Jlw6zCtDg=', 'GVrCkRQ4', 'Qxc5bjQ=', 'wocSZ8K4w4wbMQ==', 'TD7Drnk=', 'wrNCKMKfDA==', 'w7DCuMOS', 'wr5bwrPDrQU=', 'SsOZw5w6wq8=', 'w5Ntw7rCgjs=', 'w6fCsk7DlsKww7oVS8O2f0puUMKHQhw=', 'wqoGwoLCgG3DucKmDWXDq8K6W8KoLmbCpGLDkm7CizMbw7DDgcO/wqQCw6TCrHFVwoYRXk7Cm8OywobDoikGwpILw64secKGw54+ZHvCvMO8w67CnsOiwplsGMKNwo06', 'wp9DwrfDnw==', 'IsKyS8Obw5w=', 'wo0TecK+w5c=', 'AEnChQ==', 'wrRowqM=', 'woHCsGJMMQ==', 'CTLDnMO+woo=', 'wpZyGj/Dtw==', 'woJewr3DuSg=', 'wrNpEMKZBg==', 'wqURw7VSw5s=', 'w5LDl8KsWjE=', 'woRvR8K7Ew==', 'wo8AIMO/', 'w7AbSxoP', 'wrLCnTpgwpA=', 'RTbCq10=', 'wq5GwpnDnR4=', 'wpNfwrPDtmM=', 'wrVVMcK+Pg==', 'w77DrMKmcRA=', 'wqDDmhbDq8KR', 'wrJDwqA=', 'wrAyTw==', 'eg/CkSzDpMOfaMOeW2Apwq5dMTHDrMOz', 'wqHDnDULw4A=', 'RgHDkmV8', 'M2I0w4rDmg==', 'wqVxX8KdHQ==', 'woVdwrLDgjk=', 'w7XCtUHDlsKh', 'wqsVwoTCmsOV', 'wr/Diy3CrA==', 'WsOGw5oWwrk=', 'wqEvw7U=', 'wo0Tb8Kk', 'wq3DkjzCpyAHWsOGSQ==', 'cMO8ecKrwqA=', 'Sn8TwqU/', 'wo3DoCI=', 'NMOzw4g=', 'wqHDuws=', 'woPChAk=', 'w6rCqsObwr7DpMKA', 'wrBPwqA=', 'RMKlwp0=', 'MjchwrzDohk=', 'w6YNSg==', 'LSY9wrLDuBY=', 'w4Iyw6AzOg==', 'RAnCiWDDow==', 'WcK/FTrCqQ==', 'KhMgwozDqA==', 'wq90wrPDnw4=', 'w5QxcmzCvA==', 'McO5w43DpcKW', 'wrR0QsKmMA==', 'eEQwwpgs', 'e8OOw4knwr8=', 'w6TCrmfDgcKn', 'w5cPVlbDkA==', 'wqBUMMKVFw==', 'Cn7CuS0P', 'woQ0wrjDryI=', 'L1YLw6bDlA==', 'wqNfLsKlEg==', 'D8Osw7XDtMKV', 'WcOfZcKpwq4=', 'w4gtUBgh', 'wpkrwrTDtDI=', 'wpVYNsKFFw==', 'J8K7L8OTAg==', 'w5w9w7kLGw==', 'SMKDwovDsAU=', 'wr9+d8KPHQ==', 'w7LCjUjDocKN', 'wrJaPiPDoA==', 'cMOfeMK0wq8=', 'bMOqw68Mwrk=', 'wo9uwqjDiC4=', 'wq/DlSEdw6U=', 'wqgUwoTCs8O1', 'wqFVwoo=', 'cHFg', 'wpRrwqjCp358AsKQw4PCiMOWwrh3CcKr', 'acOwXQ==', 'W8ORw4w=', 'wrsJwpLCkMOBw6HDmnQB', 'e8O/Y8KuwrjCmcOkA8K/JU7CqMKNDw==', 'DXUp', '54iB5p2J5Yyw772Cw67DvuS8v+WsjuadhuW9nOerm++8lOi8peiviuaXk+aNoOaJp+S4s+ebjOW2i+S8sQ==', '5Yqm6Zqr54u95p+15Y2n77+kw4xj5L6J5a2J5pyW5byq56ii', 'wpPCpw5Kwrs=', 'wpBWwqbDpkU=', 'RgIrdyo=', 'wqDDvToQw7M=', 'wqBVGcK+Dw==', 'woLDgBA0w6U=', 'VHoRwpoe', 'wrdBPw3DgA==', 'woUDwpjCt8OQ', 'Tm/DncOkwoI=', 'woQmwqDCj8Ov', 'FsKYwrxPw4g=', 'W8ONX8K9wpE=', 'woslwp7Cu8OR', 'w4U8VDgg', 'HGDCohoR', 'PFgKw4PDpQ==', 'L8OYw7bDq8K1', 'woIFwp3CvsOE', 'AyXDiMO6wrU=', 'wr7CqAQ=', 'wrzCvARrwo7DmwXDhcOOw50/wo0YJ2DDng==', 'wqAyUcOdacKGw6fDmjglw4/Cr1bDphzDv8OjTMO8B8KmwqRtwpjCuMOeHHjCnztHwr3ClsOEJMKawqzDv8K9wrHCvcKiUUxAYcOaw48twp5Cw4vDg8Khw63CscOXw6IPK8OIRQ==', 'Thwybw==', 'RjjDqX9z', 'w7EVw6gRPA==', 'S8KIPw==', 'A24t', 'w4FrZyjCvMKiK2LDpMOdTCEB', 'OREcwp7DlQ==', 'wpLDsxfCiCY=', 'wqE8G8OBwpU=', 'w4oQw50KHg==', 'XHTDj8O6wqU=', 'w5zCvMO9worDng==', 'wrpYFx7Dig==', 'VsOcZHQ=', 'YMOjccKJwoo=', 'aCnCoV3DkA==', 'wpAYesK/', 'XMOEWcKQwp4=', 'I8OOw7HDiMKh', 'AjfDhcOBwro=', 'wrVJwojDmDU=', 'aCPCrGbDtA==', 'Dlouw4HDiA==', 'wr7CmUhkAw==', 'wqfDhwg5w6A=', 'w4vCkHHDl8Kz', 'w4guVnfCkA==', 'RB01aDzChMOe', 'SsORw5kAwrs=', 'Z8O8w7PDhBzDk8Ox', 'VCHCqkbDsw==', 'THXDgMOawpoKRA==', 'Thw9dA==', 'wq4vw7xlw7U1wrY=', 'w6XCokLDgMKj', 'A8K+L8OWD21W', 'I3gNwqs=', 'wrFdNsKAGlBK', 'fcOjbg==', 'N3YRwrbDvcKQZA==', 'w5ExfUTDrgYiw4TDqA==', 'BQfCrAXDpw==', 'w5YGWA==', 'wppFFg==', 'wol3acKTL8OFwqHCgGY=', 'w68cVhM1w7s=', 'QQc1eCfCgcOUAA==', 'AMKVfw==', 'FsOjVg=='];
(function(_0x40ef41, _0x4dbd93) {
    var _0x4b15dd = function(_0x5ac0e4) {
        while (--_0x5ac0e4) {
            _0x40ef41['push'](_0x40ef41['shift']());
        }
    };
    var _0x4233f6 = function() {
        var _0xad261f = {
            'data': {
                'key': 'cookie',
                'value': 'timeout'
            },
            'setCookie': function(_0x14a39e, _0x344f58, _0x28fff6, _0x2a4ec1) {
                _0x2a4ec1 = _0x2a4ec1 || {};
                var _0x1e9f55 = _0x344f58 + '=' + _0x28fff6;
                var _0x2059f3 = 0x0;
                for (var _0x2059f3 = 0x0, _0xf6f87b = _0x14a39e['length']; _0x2059f3 < _0xf6f87b; _0x2059f3++) {
                    var _0x46f8f5 = _0x14a39e[_0x2059f3];
                    _0x1e9f55 += ';\x20' + _0x46f8f5;
                    var _0x5ce8b3 = _0x14a39e[_0x46f8f5];
                    _0x14a39e['push'](_0x5ce8b3);
                    _0xf6f87b = _0x14a39e['length'];
                    if (_0x5ce8b3 !== !![]) {
                        _0x1e9f55 += '=' + _0x5ce8b3;
                    }
                }
                _0x2a4ec1['cookie'] = _0x1e9f55;
            },
            'removeCookie': function() {
                return 'dev';
            },
            'getCookie': function(_0x1e528b, _0x11898d) {
                _0x1e528b = _0x1e528b || function(_0x4f617a) {
                    return _0x4f617a;
                }
                ;
                var _0x4a49df = _0x1e528b(new RegExp('(?:^|;\x20)' + _0x11898d['replace'](/([.$?*|{}()[]\/+^])/g, '$1') + '=([^;]*)'));
                var _0x239cce = function(_0x269ff1, _0x11222d) {
                    _0x269ff1(++_0x11222d);
                };
                _0x239cce(_0x4b15dd, _0x4dbd93);
                return _0x4a49df ? decodeURIComponent(_0x4a49df[0x1]) : undefined;
            }
        };
        var _0xb68377 = function() {
            var _0x547c87 = new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');
            return _0x547c87['test'](_0xad261f['removeCookie']['toString']());
        };
        _0xad261f['updateCookie'] = _0xb68377;
        var _0x32f8b7 = '';
        var _0x57d33e = _0xad261f['updateCookie']();
        if (!_0x57d33e) {
            _0xad261f['setCookie'](['*'], 'counter', 0x1);
        } else if (_0x57d33e) {
            _0x32f8b7 = _0xad261f['getCookie'](null, 'counter');
        } else {
            _0xad261f['removeCookie']();
        }
    };
    _0x4233f6();
}(__0x108392, 0x89));
var _0x40b9 = function(_0x4c37ce, _0x5bb056) {
    _0x4c37ce = _0x4c37ce - 0x0;
    var _0x48af1e = __0x108392[_0x4c37ce];
    if (_0x40b9['initialized'] === undefined) {
        (function() {
            var _0x23096c = typeof window !== 'undefined' ? window : typeof process === 'object' && typeof require === 'function' && typeof global === 'object' ? global : this;
            var _0x505c1a = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            _0x23096c['atob'] || (_0x23096c['atob'] = function(_0x146d23) {
                var _0x5b6280 = String(_0x146d23)['replace'](/=+$/, '');
                for (var _0x515678 = 0x0, _0x1e1bb8, _0x3e919b, _0x586dc5 = 0x0, _0x200bc9 = ''; _0x3e919b = _0x5b6280['charAt'](_0x586dc5++); ~_0x3e919b && (_0x1e1bb8 = _0x515678 % 0x4 ? _0x1e1bb8 * 0x40 + _0x3e919b : _0x3e919b,
                _0x515678++ % 0x4) ? _0x200bc9 += String['fromCharCode'](0xff & _0x1e1bb8 >> (-0x2 * _0x515678 & 0x6)) : 0x0) {
                    _0x3e919b = _0x505c1a['indexOf'](_0x3e919b);
                }
                return _0x200bc9;
            }
            );
        }());
        var _0x3c62ad = function(_0x1f0602, _0x2d6bb6) {
            var _0x36e612 = [], _0x1e801f = 0x0, _0x3ee51c, _0x4f9031 = '', _0x410196 = '';
            _0x1f0602 = atob(_0x1f0602);
            for (var _0xf5808e = 0x0, _0x256d14 = _0x1f0602['length']; _0xf5808e < _0x256d14; _0xf5808e++) {
                _0x410196 += '%' + ('00' + _0x1f0602['charCodeAt'](_0xf5808e)['toString'](0x10))['slice'](-0x2);
            }
            _0x1f0602 = decodeURIComponent(_0x410196);
            for (var _0x4362f4 = 0x0; _0x4362f4 < 0x100; _0x4362f4++) {
                _0x36e612[_0x4362f4] = _0x4362f4;
            }
            for (_0x4362f4 = 0x0; _0x4362f4 < 0x100; _0x4362f4++) {
                _0x1e801f = (_0x1e801f + _0x36e612[_0x4362f4] + _0x2d6bb6['charCodeAt'](_0x4362f4 % _0x2d6bb6['length'])) % 0x100;
                _0x3ee51c = _0x36e612[_0x4362f4];
                _0x36e612[_0x4362f4] = _0x36e612[_0x1e801f];
                _0x36e612[_0x1e801f] = _0x3ee51c;
            }
            _0x4362f4 = 0x0;
            _0x1e801f = 0x0;
            for (var _0x40f68c = 0x0; _0x40f68c < _0x1f0602['length']; _0x40f68c++) {
                _0x4362f4 = (_0x4362f4 + 0x1) % 0x100;
                _0x1e801f = (_0x1e801f + _0x36e612[_0x4362f4]) % 0x100;
                _0x3ee51c = _0x36e612[_0x4362f4];
                _0x36e612[_0x4362f4] = _0x36e612[_0x1e801f];
                _0x36e612[_0x1e801f] = _0x3ee51c;
                _0x4f9031 += String['fromCharCode'](_0x1f0602['charCodeAt'](_0x40f68c) ^ _0x36e612[(_0x36e612[_0x4362f4] + _0x36e612[_0x1e801f]) % 0x100]);
            }
            return _0x4f9031;
        };
        _0x40b9['rc4'] = _0x3c62ad;
        _0x40b9['data'] = {};
        _0x40b9['initialized'] = !![];
    }
    var _0x31cc77 = _0x40b9['data'][_0x4c37ce];
    if (_0x31cc77 === undefined) {
        if (_0x40b9['once'] === undefined) {
            var _0x45b16f = function(_0x48d64d) {
                this['rc4Bytes'] = _0x48d64d;
                this['states'] = [0x1, 0x0, 0x0];
                this['newState'] = function() {
                    return 'newState';
                }
                ;
                this['firstState'] = '\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';
                this['secondState'] = '[\x27|\x22].+[\x27|\x22];?\x20*}';
            };
            _0x45b16f['prototype']['checkState'] = function() {
                var _0x1b8b09 = new RegExp(this['firstState'] + this['secondState']);
                return this['runState'](_0x1b8b09['test'](this['newState']['toString']()) ? --this['states'][0x1] : --this['states'][0x0]);
            }
            ;
            _0x45b16f['prototype']['runState'] = function(_0x30143d) {
                if (!Boolean(~_0x30143d)) {
                    return _0x30143d;
                }
                return this['getState'](this['rc4Bytes']);
            }
            ;
            _0x45b16f['prototype']['getState'] = function(_0x7c196f) {
                for (var _0x10340f = 0x0, _0x5cce77 = this['states']['length']; _0x10340f < _0x5cce77; _0x10340f++) {
                    this['states']['push'](Math['round'](Math['random']()));
                    _0x5cce77 = this['states']['length'];
                }
                return _0x7c196f(this['states'][0x0]);
            }
            ;
            new _0x45b16f(_0x40b9)['checkState']();
            _0x40b9['once'] = !![];
        }
        _0x48af1e = _0x40b9['rc4'](_0x48af1e, _0x5bb056);
        _0x40b9['data'][_0x4c37ce] = _0x48af1e;
    } else {
        _0x48af1e = _0x31cc77;
    }
    return _0x48af1e;
};
console[_0x40b9('0x0', 'Z&UK')](_0x40b9('0x1', 'BWAP'));
(function(_0xbd1e2b, _0x1b9697, _0x4e2f4f) {
    var _0x11e36e = {
        'IndBA': _0x40b9('0x2', '4ilJ'),
        'KnzbE': function _0xb59353(_0x5a52b9) {
            return _0x5a52b9();
        },
        'quHSD': function _0x322bdc(_0x58b879, _0x3c03f5) {
            return _0x58b879 !== _0x3c03f5;
        },
        'iSPFS': _0x40b9('0x3', 'KFud'),
        'CVlYO': _0x40b9('0x4', 'u!eB'),
        'KdnBw': function _0x29e964(_0x1207b3, _0x492357) {
            return _0x1207b3 !== _0x492357;
        },
        'ausMw': _0x40b9('0x5', 'UpWj'),
        'JAVzH': function _0x5b57e3(_0xe73fb6, _0x4a25d7) {
            return _0xe73fb6 === _0x4a25d7;
        },
        'eefak': _0x40b9('0x6', 'R7AR'),
        'EBhNv': _0x40b9('0x7', 'aT^a'),
        'qHRmL': function _0x5b9db2(_0x41f3a1, _0x42dbbf) {
            return _0x41f3a1 + _0x42dbbf;
        },
        'BJjsI': _0x40b9('0x8', '9bLo'),
        'uqHWG': _0x40b9('0x9', '^W6a'),
        'LbkKc': function _0x29b520(_0x1a443d, _0x519f32, _0x3aa419) {
            return _0x1a443d(_0x519f32, _0x3aa419);
        }
    };
    var _0x2a1d7b = _0x11e36e[_0x40b9('0xa', 'k5JY')][_0x40b9('0xb', 'Jvja')]('|')
      , _0x3b2a83 = 0x0;
    while (!![]) {
        switch (_0x2a1d7b[_0x3b2a83++]) {
        case '0':
            var _0x27a633 = function() {
                var _0x57cf34 = !![];
                return function(_0x5be0fa, _0x3dd30f) {
                    var _0x257e26 = _0x57cf34 ? function() {
                        if (_0x3dd30f) {
                            var _0x1ba642 = _0x3dd30f[_0x40b9('0xc', 'wbvI')](_0x5be0fa, arguments);
                            _0x3dd30f = null;
                            return _0x1ba642;
                        }
                    }
                    : function() {}
                    ;
                    _0x57cf34 = ![];
                    return _0x257e26;
                }
                ;
            }();
            continue;
        case '1':
            _0x11e36e[_0x40b9('0xd', '[Tn3')](_0x47d3a6);
            continue;
        case '2':
            try {
                if (_0x11e36e[_0x40b9('0xe', 'P$4U')](_0x11e36e[_0x40b9('0xf', '[Tn3')], _0x11e36e[_0x40b9('0x10', 'iM0m')])) {
                    while (!![]) {}
                } else {
                    _0x4e2f4f += _0x11e36e[_0x40b9('0x11', 'PE^A')];
                    _0x1b9697 = encode_version;
                    if (!(_0x11e36e[_0x40b9('0x12', 'UpWj')](typeof _0x1b9697, _0x11e36e[_0x40b9('0x13', '[zZU')]) && _0x11e36e[_0x40b9('0x14', 'UpWj')](_0x1b9697, _0x11e36e[_0x40b9('0x15', 'UMWj')]))) {
                        if (_0x11e36e[_0x40b9('0x16', 'R7AR')](_0x11e36e[_0x40b9('0x17', 'UpWj')], _0x11e36e[_0x40b9('0x18', 'k([C')])) {
                            _0xbd1e2b[_0x4e2f4f](_0x11e36e[_0x40b9('0x19', 'bln4')]('删除', _0x11e36e[_0x40b9('0x1a', 'aT^a')]));
                        } else {}
                    }
                }
            } catch (_0x2e7e7e) {
                _0xbd1e2b[_0x4e2f4f](_0x11e36e[_0x40b9('0x1b', 'Awpo')]);
            }
            continue;
        case '3':
            var _0x27c071 = {
                'MFEpY': function _0x1a34ba(_0x186c49, _0x53e75b, _0x4d703b) {
                    return _0x11e36e[_0x40b9('0x1c', 'UpWj')](_0x186c49, _0x53e75b, _0x4d703b);
                }
            };
            continue;
        case '4':
            (function() {
                _0x27c071[_0x40b9('0x1d', '&sf#')](_0x918922, this, function() {
                    var _0xe0b043 = {
                        'xROKY': function _0x5392df(_0x529d9d, _0x3a8db9) {
                            return _0x529d9d === _0x3a8db9;
                        },
                        'ZYHJv': _0x40b9('0x1e', 'k5JY'),
                        'RkEnV': _0x40b9('0x1f', 'k5JY'),
                        'snaSP': _0x40b9('0x20', '^U$s'),
                        'ZsHSN': function _0x939045(_0x402651, _0x1d384d) {
                            return _0x402651(_0x1d384d);
                        },
                        'NODJE': _0x40b9('0x21', 'wbvI'),
                        'qoxNS': function _0x2f1418(_0x54791b, _0x25972f) {
                            return _0x54791b + _0x25972f;
                        },
                        'YzytQ': _0x40b9('0x22', 'YL3f'),
                        'MHPWG': function _0x3b47fb(_0x1ad44e, _0x16102b) {
                            return _0x1ad44e + _0x16102b;
                        },
                        'ygOtS': _0x40b9('0x23', 'jc*^'),
                        'LTHKV': function _0x4a4c05(_0x2aaeba, _0x593f21) {
                            return _0x2aaeba(_0x593f21);
                        },
                        'CdVsx': function _0x5da1f6(_0x33156d, _0xa5f625) {
                            return _0x33156d !== _0xa5f625;
                        },
                        'YptOu': _0x40b9('0x24', 'jTP2'),
                        'pHNqd': _0x40b9('0x25', '!YCU'),
                        'GYgzG': function _0x472d37(_0xc054bd) {
                            return _0xc054bd();
                        },
                        'JWQbw': _0x40b9('0x26', 'PE^A')
                    };
                    if (_0xe0b043[_0x40b9('0x27', 'BWAP')](_0xe0b043[_0x40b9('0x28', 'hVlF')], _0xe0b043[_0x40b9('0x29', '%J*V')])) {
                        var _0x34bf6c = new RegExp(_0xe0b043[_0x40b9('0x2a', 'jc*^')]);
                        var _0x594c67 = new RegExp(_0xe0b043[_0x40b9('0x2b', '[zZU')],'i');
                        var _0x1d2835 = _0xe0b043[_0x40b9('0x2c', '^W6a')](_0xd14274, _0xe0b043[_0x40b9('0x2d', 'PE^A')]);
                        if (!_0x34bf6c[_0x40b9('0x2e', 'KFud')](_0xe0b043[_0x40b9('0x2f', 'R7AR')](_0x1d2835, _0xe0b043[_0x40b9('0x30', '^cz!')])) || !_0x594c67[_0x40b9('0x31', '&5x2')](_0xe0b043[_0x40b9('0x32', 'R7AR')](_0x1d2835, _0xe0b043[_0x40b9('0x33', 'Awpo')]))) {
                            _0xe0b043[_0x40b9('0x34', '&sf#')](_0x1d2835, '0');
                        } else {
                            if (_0xe0b043[_0x40b9('0x35', '1isK')](_0xe0b043[_0x40b9('0x36', '^cz!')], _0xe0b043[_0x40b9('0x37', 'aT^a')])) {
                                _0xe0b043[_0x40b9('0x38', 'i1BC')](_0xd14274);
                            } else {
                                _0xe0b043[_0x40b9('0x39', '[Tn3')](debuggerProtection, 0x0);
                            }
                        }
                    } else {
                        var _0x4a9faa = _0xe0b043[_0x40b9('0x3a', '$e#X')][_0x40b9('0x3b', 'nWBz')]('|')
                          , _0x2c1fac = 0x0;
                        while (!![]) {
                            switch (_0x4a9faa[_0x2c1fac++]) {
                            case '0':
                                that[_0x40b9('0x3c', 'wbvI')][_0x40b9('0x3d', 'u!eB')] = func;
                                continue;
                            case '1':
                                that[_0x40b9('0x3e', 'ILbD')][_0x40b9('0x3f', '^cz!')] = func;
                                continue;
                            case '2':
                                that[_0x40b9('0x40', '[zZU')][_0x40b9('0x41', 'wbvI')] = func;
                                continue;
                            case '3':
                                that[_0x40b9('0x42', '71i%')][_0x40b9('0x43', '$e#X')] = func;
                                continue;
                            case '4':
                                that[_0x40b9('0x44', 'RsXR')][_0x40b9('0x45', '!YCU')] = func;
                                continue;
                            case '5':
                                that[_0x40b9('0x46', '7zYQ')][_0x40b9('0x47', 'R7AR')] = func;
                                continue;
                            case '6':
                                that[_0x40b9('0x48', '!YCU')][_0x40b9('0x49', 'ig^U')] = func;
                                continue;
                            }
                            break;
                        }
                    }
                })();
            }());
            continue;
        case '5':
            var _0x47d3a6 = _0x11e36e[_0x40b9('0x4a', '9bLo')](_0x27a633, this, function() {
                var _0x3db492 = {
                    'KtPui': function _0x57f614(_0x675a6c, _0x3966e5) {
                        return _0x675a6c !== _0x3966e5;
                    },
                    'rQkDL': _0x40b9('0x4b', 'k([C'),
                    'FkNTO': _0x40b9('0x4c', 'P$4U'),
                    'wxkqN': function _0x371138(_0x424164, _0x47418e) {
                        return _0x424164 !== _0x47418e;
                    },
                    'VNmAj': _0x40b9('0x4d', '^U$s'),
                    'TDBrm': function _0x24f4b5(_0xefce84, _0x40619b) {
                        return _0xefce84 === _0x40619b;
                    },
                    'suTyf': _0x40b9('0x4e', 'k([C'),
                    'kgBGp': _0x40b9('0x4f', 'wbvI'),
                    'QFikQ': _0x40b9('0x50', 'uT]S'),
                    'NNstI': _0x40b9('0x51', 'Q]f['),
                    'psWqX': function _0x370fd4(_0x2ad796, _0x1cb907) {
                        return _0x2ad796 === _0x1cb907;
                    },
                    'fokwb': _0x40b9('0x52', 'P$4U'),
                    'EuyUl': _0x40b9('0x53', 'YL3f')
                };
                if (_0x3db492[_0x40b9('0x54', 'Jvja')](_0x3db492[_0x40b9('0x55', '$e#X')], _0x3db492[_0x40b9('0x56', '4ilJ')])) {
                    var _0x551559 = function() {
                        var _0x4954c0 = {
                            'gGIQb': function _0x5f3522(_0x4f6ef2, _0x471a24) {
                                return _0x4f6ef2 === _0x471a24;
                            },
                            'sdfLj': _0x40b9('0x57', '71i%')
                        };
                        if (_0x4954c0[_0x40b9('0x58', '9bLo')](_0x4954c0[_0x40b9('0x59', 'ig^U')], _0x4954c0[_0x40b9('0x5a', 'u!eB')])) {} else {
                            var _0x39a324 = firstCall ? function() {
                                if (fn) {
                                    var _0x3d24bc = fn[_0x40b9('0x5b', 'uT]S')](context, arguments);
                                    fn = null;
                                    return _0x3d24bc;
                                }
                            }
                            : function() {}
                            ;
                            firstCall = ![];
                            return _0x39a324;
                        }
                    };
                    var _0x48907e = _0x3db492[_0x40b9('0x5c', 'k5JY')](typeof window, _0x3db492[_0x40b9('0x5d', '&5x2')]) ? window : _0x3db492[_0x40b9('0x5e', '%J*V')](typeof process, _0x3db492[_0x40b9('0x5f', 'iM0m')]) && _0x3db492[_0x40b9('0x60', 'jc*^')](typeof require, _0x3db492[_0x40b9('0x61', 'K6u2')]) && _0x3db492[_0x40b9('0x62', 'Q]f[')](typeof global, _0x3db492[_0x40b9('0x63', 'Z&UK')]) ? global : this;
                    if (!_0x48907e[_0x40b9('0x64', 'u!eB')]) {
                        if (_0x3db492[_0x40b9('0x65', 'aT^a')](_0x3db492[_0x40b9('0x66', '^cz!')], _0x3db492[_0x40b9('0x67', ')%3l')])) {
                            debugger ;
                        } else {
                            _0x48907e[_0x40b9('0x68', 'PE^A')] = function(_0x5d3d72) {
                                var _0x4a87d3 = {
                                    'ORIsX': _0x40b9('0x69', '1isK')
                                };
                                var _0x8f4d2 = _0x4a87d3[_0x40b9('0x6a', 'jc*^')][_0x40b9('0x6b', '^W6a')]('|')
                                  , _0x278633 = 0x0;
                                while (!![]) {
                                    switch (_0x8f4d2[_0x278633++]) {
                                    case '0':
                                        _0x4e2f4f[_0x40b9('0x6c', '%J*V')] = _0x5d3d72;
                                        continue;
                                    case '1':
                                        _0x4e2f4f[_0x40b9('0x6d', 'PE^A')] = _0x5d3d72;
                                        continue;
                                    case '2':
                                        _0x4e2f4f[_0x40b9('0x6e', '5ZGr')] = _0x5d3d72;
                                        continue;
                                    case '3':
                                        _0x4e2f4f[_0x40b9('0x6f', 'nWBz')] = _0x5d3d72;
                                        continue;
                                    case '4':
                                        _0x4e2f4f[_0x40b9('0x70', 'iM0m')] = _0x5d3d72;
                                        continue;
                                    case '5':
                                        return _0x4e2f4f;
                                    case '6':
                                        _0x4e2f4f[_0x40b9('0x71', '1isK')] = _0x5d3d72;
                                        continue;
                                    case '7':
                                        _0x4e2f4f[_0x40b9('0x72', '%J*V')] = _0x5d3d72;
                                        continue;
                                    case '8':
                                        var _0x4e2f4f = {};
                                        continue;
                                    }
                                    break;
                                }
                            }(_0x551559);
                        }
                    } else {
                        if (_0x3db492[_0x40b9('0x73', 'hVlF')](_0x3db492[_0x40b9('0x74', 'wbvI')], _0x3db492[_0x40b9('0x75', 'BWAP')])) {
                            var _0x313953 = _0x3db492[_0x40b9('0x76', '^W6a')][_0x40b9('0x77', '71i%')]('|')
                              , _0x41a34a = 0x0;
                            while (!![]) {
                                switch (_0x313953[_0x41a34a++]) {
                                case '0':
                                    _0x48907e[_0x40b9('0x78', 'bln4')][_0x40b9('0x79', 'k5JY')] = _0x551559;
                                    continue;
                                case '1':
                                    _0x48907e[_0x40b9('0x46', '7zYQ')][_0x40b9('0x7a', 'jc*^')] = _0x551559;
                                    continue;
                                case '2':
                                    _0x48907e[_0x40b9('0x7b', 'hVlF')][_0x40b9('0x7c', ')%3l')] = _0x551559;
                                    continue;
                                case '3':
                                    _0x48907e[_0x40b9('0x40', '[zZU')][_0x40b9('0x7d', '4ilJ')] = _0x551559;
                                    continue;
                                case '4':
                                    _0x48907e[_0x40b9('0x78', 'bln4')][_0x40b9('0x7e', 'bln4')] = _0x551559;
                                    continue;
                                case '5':
                                    _0x48907e[_0x40b9('0x3c', 'wbvI')][_0x40b9('0x7f', 'wbvI')] = _0x551559;
                                    continue;
                                case '6':
                                    _0x48907e[_0x40b9('0x80', '&5x2')][_0x40b9('0x81', 'YL3f')] = _0x551559;
                                    continue;
                                }
                                break;
                            }
                        } else {
                            var _0x309f5d = fn[_0x40b9('0x82', '7zYQ')](context, arguments);
                            fn = null;
                            return _0x309f5d;
                        }
                    }
                } else {}
            });
            continue;
        case '6':
            var _0x918922 = function() {
                var _0x5c2d48 = !![];
                return function(_0x13ae9f, _0x456dea) {
                    var _0x15a889 = {
                        'HvmFH': function _0x4e7920(_0x5b9ef9, _0x1a3ac5) {
                            return _0x5b9ef9 === _0x1a3ac5;
                        },
                        'tzdYq': _0x40b9('0x83', '^W6a')
                    };
                    if (_0x15a889[_0x40b9('0x84', '1isK')](_0x15a889[_0x40b9('0x85', 'u!eB')], _0x15a889[_0x40b9('0x86', '4ilJ')])) {
                        var _0x2a67e9 = _0x5c2d48 ? function() {
                            var _0xd3a1b8 = {
                                'bIAtM': _0x40b9('0x87', '$e#X'),
                                'hQgDA': _0x40b9('0x88', '1isK'),
                                'dRDCN': function _0x4582b8(_0x19cc1f, _0x1c21c8) {
                                    return _0x19cc1f(_0x1c21c8);
                                },
                                'xvJMZ': _0x40b9('0x89', '1isK'),
                                'pewlY': function _0x28d758(_0x2455f7, _0x3d504a) {
                                    return _0x2455f7 + _0x3d504a;
                                },
                                'hTPhj': _0x40b9('0x8a', 'uT]S'),
                                'XkGvS': function _0x1feb36(_0x1d87eb, _0x462550) {
                                    return _0x1d87eb + _0x462550;
                                },
                                'pyyyR': _0x40b9('0x8b', '&5x2'),
                                'ggiMK': function _0x1ec0ea(_0x22230b, _0x4d5196) {
                                    return _0x22230b(_0x4d5196);
                                },
                                'HiNho': function _0x5df0b2(_0x5ab190) {
                                    return _0x5ab190();
                                },
                                'xpMRu': function _0x2fc4de(_0x589da3, _0x47ff78) {
                                    return _0x589da3 === _0x47ff78;
                                },
                                'GQQtf': _0x40b9('0x8c', 'bln4'),
                                'beIkx': _0x40b9('0x8d', 'Jvja'),
                                'tscRe': function _0x1e3084(_0x38f4ce, _0x5f0435, _0x19000d) {
                                    return _0x38f4ce(_0x5f0435, _0x19000d);
                                }
                            };
                            if (_0x456dea) {
                                if (_0xd3a1b8[_0x40b9('0x8e', 'i1BC')](_0xd3a1b8[_0x40b9('0x8f', '&sf#')], _0xd3a1b8[_0x40b9('0x90', 'PE^A')])) {
                                    _0xd3a1b8[_0x40b9('0x91', '1isK')](_0x918922, this, function() {
                                        var _0x5c26ef = new RegExp(_0xd3a1b8[_0x40b9('0x92', 'P$4U')]);
                                        var _0x2a872f = new RegExp(_0xd3a1b8[_0x40b9('0x93', '71i%')],'i');
                                        var _0x170b8b = _0xd3a1b8[_0x40b9('0x94', '@Phb')](_0xd14274, _0xd3a1b8[_0x40b9('0x95', '^U$s')]);
                                        if (!_0x5c26ef[_0x40b9('0x96', '%J*V')](_0xd3a1b8[_0x40b9('0x97', 'k([C')](_0x170b8b, _0xd3a1b8[_0x40b9('0x98', 'k5JY')])) || !_0x2a872f[_0x40b9('0x99', '^cz!')](_0xd3a1b8[_0x40b9('0x9a', '1isK')](_0x170b8b, _0xd3a1b8[_0x40b9('0x9b', 'Jvja')]))) {
                                            _0xd3a1b8[_0x40b9('0x9c', '7zYQ')](_0x170b8b, '0');
                                        } else {
                                            _0xd3a1b8[_0x40b9('0x9d', '@Phb')](_0xd14274);
                                        }
                                    })();
                                } else {
                                    var _0x133721 = _0x456dea[_0x40b9('0x9e', 'K6u2')](_0x13ae9f, arguments);
                                    _0x456dea = null;
                                    return _0x133721;
                                }
                            }
                        }
                        : function() {
                            var _0x218a02 = {
                                'JOuyv': function _0x36c568(_0x2c2690, _0xe860d2) {
                                    return _0x2c2690 !== _0xe860d2;
                                },
                                'cQZsa': _0x40b9('0x9f', 'Jvja'),
                                'MpTzv': _0x40b9('0xa0', '&5x2'),
                                'YhRkT': _0x40b9('0xa1', 'g!ZE')
                            };
                            if (_0x218a02[_0x40b9('0xa2', '[Tn3')](_0x218a02[_0x40b9('0xa3', 'YL3f')], _0x218a02[_0x40b9('0xa4', 'aT^a')])) {} else {
                                var _0x42c383 = _0x218a02[_0x40b9('0xa5', '^U$s')][_0x40b9('0xa6', '1isK')]('|')
                                  , _0x26849f = 0x0;
                                while (!![]) {
                                    switch (_0x42c383[_0x26849f++]) {
                                    case '0':
                                        _0x34eca9[_0x40b9('0xa7', '$e#X')] = func;
                                        continue;
                                    case '1':
                                        _0x34eca9[_0x40b9('0xa8', 'UpWj')] = func;
                                        continue;
                                    case '2':
                                        return _0x34eca9;
                                    case '3':
                                        _0x34eca9[_0x40b9('0xa9', 'hVlF')] = func;
                                        continue;
                                    case '4':
                                        _0x34eca9[_0x40b9('0xaa', 'u!eB')] = func;
                                        continue;
                                    case '5':
                                        _0x34eca9[_0x40b9('0xab', '71i%')] = func;
                                        continue;
                                    case '6':
                                        _0x34eca9[_0x40b9('0xac', '&5x2')] = func;
                                        continue;
                                    case '7':
                                        _0x34eca9[_0x40b9('0xad', 'hVlF')] = func;
                                        continue;
                                    case '8':
                                        var _0x34eca9 = {};
                                        continue;
                                    }
                                    break;
                                }
                            }
                        }
                        ;
                        _0x5c2d48 = ![];
                        return _0x2a67e9;
                    } else {
                        var _0x540a31 = _0x456dea[_0x40b9('0xae', 'R7AR')](_0x13ae9f, arguments);
                        _0x456dea = null;
                        return _0x540a31;
                    }
                }
                ;
            }();
            continue;
        case '7':
            _0x4e2f4f = 'al';
            continue;
        }
        break;
    }
}(window));
setInterval(function() {
    var _0x236bed = {
        'wVRyr': function _0x1bb2cd(_0x35dee7) {
            return _0x35dee7();
        }
    };
    _0x236bed[_0x40b9('0xaf', 'iM0m')](_0xd14274);
}, 0xfa0);
function _0xd14274(_0x3e1077) {
    var _0x1b8046 = {
        'UEKHg': function _0xc58689(_0x158c16, _0x1e4fe2) {
            return _0x158c16 === _0x1e4fe2;
        },
        'HSlnw': _0x40b9('0xb0', 'K6u2'),
        'DFaoS': function _0x29a037(_0x6cce96, _0x2b9427) {
            return _0x6cce96 === _0x2b9427;
        },
        'Gjnvb': _0x40b9('0xb1', 'Awpo'),
        'ZVCRD': _0x40b9('0xb2', 'hVlF'),
        'CgzyT': _0x40b9('0xb3', 'k5JY'),
        'sJhTI': function _0x20c948(_0x517702, _0x39d501) {
            return _0x517702(_0x39d501);
        },
        'FMmwo': function _0x1addf5(_0x25f2b9, _0x4d7e9f) {
            return _0x25f2b9 !== _0x4d7e9f;
        },
        'aSqsv': function _0x404144(_0x37953d, _0x2c4145) {
            return _0x37953d + _0x2c4145;
        },
        'RIWog': function _0x5abcd4(_0x458e70, _0x50bce9) {
            return _0x458e70 / _0x50bce9;
        },
        'yCvcc': _0x40b9('0xb4', '^W6a'),
        'fsrFR': function _0x1fb72b(_0x2497b0, _0x1276dd) {
            return _0x2497b0 % _0x1276dd;
        }
    };
    function _0x5f3f5e(_0x27f3eb) {
        var _0x980f18 = {
            'ZIxWr': function _0x29c86c(_0x2183f7, _0x39bd95) {
                return _0x2183f7 === _0x39bd95;
            },
            'uZQIb': _0x40b9('0xb5', 'Jvja'),
            'BRhBP': _0x40b9('0xb6', ')%3l'),
            'kPsYd': function _0x37671c(_0x185943) {
                return _0x185943();
            },
            'YYmtC': function _0x55d059(_0x12be85, _0xe0203b) {
                return _0x12be85 === _0xe0203b;
            },
            'ooHrX': _0x40b9('0xb7', 'BWAP'),
            'HmOPy': function _0x1d6f19(_0x18dec9, _0x51580d) {
                return _0x18dec9 !== _0x51580d;
            },
            'EmqDa': _0x40b9('0xb8', 'ig^U'),
            'eiGtc': function _0x330cfb(_0x11bb9c, _0x4325d5) {
                return _0x11bb9c !== _0x4325d5;
            },
            'cFHwN': function _0x5a5679(_0x59344d, _0x32a97e) {
                return _0x59344d + _0x32a97e;
            },
            'rfhfb': function _0x313996(_0x42f696, _0x33efda) {
                return _0x42f696 / _0x33efda;
            },
            'gVIZR': _0x40b9('0xb9', 'BWAP'),
            'QDkVx': function _0x4dfcc7(_0x41a876, _0x9eb6a) {
                return _0x41a876 % _0x9eb6a;
            },
            'qmvVg': function _0x2d2834(_0x51093b, _0x1d0bf8) {
                return _0x51093b(_0x1d0bf8);
            }
        };
        if (_0x980f18[_0x40b9('0xba', 'jc*^')](_0x980f18[_0x40b9('0xbb', '^cz!')], _0x980f18[_0x40b9('0xbc', 'jTP2')])) {
            var _0x102de4 = function() {
                while (!![]) {}
            };
            return _0x980f18[_0x40b9('0xbd', 'BWAP')](_0x102de4);
        } else {
            if (_0x980f18[_0x40b9('0xbe', '1isK')](typeof _0x27f3eb, _0x980f18[_0x40b9('0xbf', 'nWBz')])) {
                var _0x315454 = function() {
                    while (!![]) {}
                };
                return _0x980f18[_0x40b9('0xc0', 'Awpo')](_0x315454);
            } else {
                if (_0x980f18[_0x40b9('0xc1', '^U$s')](_0x980f18[_0x40b9('0xc2', 'iM0m')], _0x980f18[_0x40b9('0xc3', 'u!eB')])) {
                    return _0x5f3f5e;
                } else {
                    if (_0x980f18[_0x40b9('0xc4', '$e#X')](_0x980f18[_0x40b9('0xc5', 'ig^U')]('', _0x980f18[_0x40b9('0xc6', '7zYQ')](_0x27f3eb, _0x27f3eb))[_0x980f18[_0x40b9('0xc7', 'bln4')]], 0x1) || _0x980f18[_0x40b9('0xc8', '5ZGr')](_0x980f18[_0x40b9('0xc9', 'aT^a')](_0x27f3eb, 0x14), 0x0)) {
                        debugger ;
                    } else {
                        debugger ;
                    }
                }
            }
            _0x980f18[_0x40b9('0xca', '7zYQ')](_0x5f3f5e, ++_0x27f3eb);
        }
    }
    try {
        if (_0x1b8046[_0x40b9('0xcb', 'Awpo')](_0x1b8046[_0x40b9('0xcc', 'R7AR')], _0x1b8046[_0x40b9('0xcd', 'k([C')])) {
            if (_0x3e1077) {
                if (_0x1b8046[_0x40b9('0xce', '5ZGr')](_0x1b8046[_0x40b9('0xcf', '7zYQ')], _0x1b8046[_0x40b9('0xd0', 'RsXR')])) {
                    return _0x5f3f5e;
                } else {}
            } else {
                if (_0x1b8046[_0x40b9('0xd1', 'jc*^')](_0x1b8046[_0x40b9('0xd2', ')%3l')], _0x1b8046[_0x40b9('0xd3', '^U$s')])) {} else {
                    _0x1b8046[_0x40b9('0xd4', '$e#X')](_0x5f3f5e, 0x0);
                }
            }
        } else {
            if (_0x1b8046[_0x40b9('0xd5', 'PE^A')](_0x1b8046[_0x40b9('0xd6', 'R7AR')]('', _0x1b8046[_0x40b9('0xd7', 'u!eB')](counter, counter))[_0x1b8046[_0x40b9('0xd8', '1isK')]], 0x1) || _0x1b8046[_0x40b9('0xd9', '[Tn3')](_0x1b8046[_0x40b9('0xda', 'UpWj')](counter, 0x14), 0x0)) {
                debugger ;
            } else {
                debugger ;
            }
        }
    } catch (_0x900d0a) {}
}
;encode_version = 'jsjiami.com.v5';

```

可以看到大量调用了`_0x40b9('0xd5', 'PE^A')`类型的方法，因此_0x40b9（）方法为解密方法，编写脚本如下：

分析：因为_0x40b9（）为解密方法，所以我们在还原的脚本中要调用到该方法，直接将该方法拿出来，但是其中会对一些代码进行正则匹配，来查看是否进行了格式化处理，所以我们要查找出RegExp方法来修改返回值或者取消缩进。

```javascript
;var encode_version = 'jsjiami.com.v5'
  , eudlm = '__0x108392'
  , __0x108392 = ['wrN5JA==', 'FCzCumooasOSwp0Mwq7DqMKzwqU=', 'wqhSwprDulg=', 'w7PClkvDscKI', 'w6F8w5DCjwU=', 'wp4Rw4I=', 'LiLCjh/Dpg==', 'w4cteG3DtA==', 'TcOHw54vwrQ=', 'IMKqWsOew4s=', 'wq3CsQF5wrQ=', 'wrIzZMKKw4k=', 'wq8hEcO5wo4=', 'TlwVwqUr', 'w4w/w5oWJQ==', 'wqrDjSTDgMKY', 'LMOkbSdk', 'wr5PwrnCiVc=', 'XcOMw5YQwrFzw54=', 'KlYiw4LDgQ==', 'YBXCsULDkA==', 'XMKbwrvDlgg=', 'wpd4PSfDoMKyfA==', 'w45Rw6zDl3rCr8K+TmvDiMK7X8KzbWrCgzY=', 'w5cpw5EXEA==', 'w7XCv8OZwrDDpA==', 'wp8AMcO+woQ=', 'wpFlITvDvQ==', 
                  
                  
                  略......
                  
                  
        } else {
            _0xad261f['removeCookie']();
        }
    };
    _0x4233f6();
}(__0x108392, 0x89));
var _0x40b9 = function(_0x4c37ce, _0x5bb056) {
    _0x4c37ce = _0x4c37ce - 0x0;
    var _0x48af1e = __0x108392[_0x4c37ce];
    if (_0x40b9['initialized'] === undefined) {
        (function() {
            var _0x23096c = typeof window !== 'undefined' ? window : typeof process === 'object' && typeof 
                
                略......
                
        }
        _0x48af1e = _0x40b9['rc4'](_0x48af1e, _0x5bb056);
        _0x40b9['data'][_0x4c37ce] = _0x48af1e;
    } else {
        _0x48af1e = _0x31cc77;
    }
    return _0x48af1e;
};
```

通过调试发现该正则匹配的结果为0，所以直接修改返回

![image-20231022035437391](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310220354432.png)

将`new RegExp('(?:^|;\x20)' + _0x11898d['replace'](/([.$?*|{}()[]\/+^])/g, '$1') + '=([^;]*)')`替换为1

![image-20231022035419707](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310220354813.png)

该句正则则是对上面的removeCookie方法进行匹配，是否进行换行等处理

![image-20231022035604586](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310220356650.png)

直接将removeCookie方法的换行都删掉

![image-20231022035726794](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310220357827.png)

下面的正则匹配也进行如上处理

编写解密代码，找出_0x40b9解密方法调用的地方，调用该解密方法，并将返回值与未解密前的部分进行替换

```javascript
const fs = require('fs');
const types = require("@babel/types");
const parser = require("@babel/parser");
require("./sfds.js");
const { assertSourceType } = require("@babel/core/lib/config/validation/option-assertions");
const traverse = require("@babel/traverse").default;
const generator = require("@babel/generator").default;

解密方法

const jscode = fs.readFileSync("./code.js", {
    encoding: "utf-8"
});
let ast = parser.parse(jscode);

traverse(ast, {
    CallExpression: function (path) { //当进入这个Node的时候，开始执行以下代码
        if(path.node.callee.name="_0x40b9"){
            if(path.node.arguments.length==2){
                if(path.node.arguments[0].type=="StringLiteral"&&path.node.arguments[1].type=="StringLiteral"){
                    console.log(path.node.callee.name);
                    var ret = _0x40b9(path.node.arguments[0].value,path.node.arguments[1].value)
                    path.replaceWith(types.valueToNode(ret));
                    console.log(ret);
                }
                // console.log(path.node.arguments[0].type);
            }
        }
    }
})

let { code } = generator(ast);
fs.writeFileSync("./newcode.js", code);
```

得到结果如下，上一部分注释的内容为解密的代码，下半部分注释的内容为只执行函数等垃圾代码

```javascript
// ;
// var encode_version = 'jsjiami.com.v5',
//   eudlm = '__0x108392',
//   __0x108392 = ['wrN5JA==', 'FCzCumooasOSwp0Mwq7DqMKzwqU=', 'wqhSwprDulg=', 'w7PClkvDscKI', 'w6F8w5DCjwU=', 'wp4Rw4I=', 'LiLCjh/Dpg==', 'w4cteG3DtA==', 'TcOHw54vwrQ=', 'IMKqWsOew4s=', 'wq3CsQF5wrQ=', 'wrIzZMKKw4k=', 'wq8hEcO5wo4=', 'TlwVwqUr', 'w4w/w5oWJQ==', 'wqrDjSTDgMKY', 'LMOkbSdk', 'wr5PwrnCiVc=', 'XcOMw5YQwrFzw54=', 'KlYiw4LDgQ==', 'YBXCsULDkA==', 'XMKbwrvDlgg=', 'wpd4PSfDoMKyfA==', 'w45Rw6zDl3rCr8K+TmvDiMK7X8KzbWrCgzY=', 'w5cpw5EXEA==', 'w7XCv8OZwrDDpA==', 'wp8AMcO+woQ=', 'wpFlITvDvQ==', 'wrECwrI=', 'w54mWXvClGNMF1A=', 'VEcnwrM=', 'woJfwr/DiCg=', 'wowEIcOl', 'wrjDmQjCswg=', 'QR0wbDE=', 


略略......
//         return _0x40b9(this['states'][0x0]);
//       };
//       new _0x45b16f(_0x40b9)['checkState']();
//       _0x40b9['once'] = !![];
//     }
//     _0x48af1e = _0x40b9['rc4'](_0x48af1e, _0x5bb056);
//     _0x40b9['data'][_0x4c37ce] = _0x48af1e;
//   } else {
//     _0x48af1e = _0x31cc77;
//   }
//   return _0x48af1e;
// };
console["log"]("123");
// (function (_0xbd1e2b, _0x1b9697, _0x4e2f4f) {
//   var _0x11e36e = {
//     'IndBA': "3|6|4|0|5|1|7|2",
//     'KnzbE': function _0xb59353(_0x5a52b9) {
//       return _0x40b9();
//     },
//     'quHSD': function _0x322bdc(_0x58b879, _0x3c03f5) {
//       return _0x58b879 !== _0x3c03f5;
//     },
//     'iSPFS': "KIJ",
//     'CVlYO': "ert",
略......
// encode_version = 'jsjiami.com.v5';
```

最终还原出js代码

```javascript
console["log"]("123");
```



# AST还原ob混淆

直接将一段代码进行ob混淆

```javascript
function _0x370a() {
    var _0x317fb2 = ['=([^;]*)\x5cb', '247bVFGWf', '87ImazDn', '#password-err', '123456', '99PWIONp', 'json', '4DSXLIj', '31549APcyqi', '105JCZqoC', '304944DqOHSb', '87536RNJUpa', 'ajax', 'href', '13741145tvluDZ', 'show', '/api/v1.0/sessions', '1695948fKwQaM', 'cookie', 'html', '#password-err\x20span', '1555555555', '806710EHakAu', '582406FwXBpi', '424iLpQwH'];
    _0x370a = function() {
        return _0x317fb2;
    }
    ;
    return _0x370a();
}
function _0x47ce(_0x29adb8, _0x53dd09) {
    var _0x370ab2 = _0x370a();
    return _0x47ce = function(_0x47cef9, _0x5981df) {
        _0x47cef9 = _0x47cef9 - 0x1a7;
        var _0x295d66 = _0x370ab2[_0x47cef9];
        return _0x295d66;
    }
    ,
    _0x47ce(_0x29adb8, _0x53dd09);
}
var _0x32c61d = _0x47ce;
(function(_0x1cb5eb, _0x5f5480) {
    var _0x19ddc7 = _0x47ce
      , _0x4c8d6a = _0x1cb5eb();
    while (!![]) {
        try {
            var _0x1439cb = -parseInt(_0x19ddc7(0x1af)) / 0x1 * (-parseInt(_0x19ddc7(0x1bf)) / 0x2) + parseInt(_0x19ddc7(0x1aa)) / 0x3 * (parseInt(_0x19ddc7(0x1b3)) / 0x4) + -parseInt(_0x19ddc7(0x1b1)) / 0x5 * (-parseInt(_0x19ddc7(0x1b2)) / 0x6) + -parseInt(_0x19ddc7(0x1b0)) / 0x7 * (-parseInt(_0x19ddc7(0x1a7)) / 0x8) + parseInt(_0x19ddc7(0x1ad)) / 0x9 * (-parseInt(_0x19ddc7(0x1be)) / 0xa) + parseInt(_0x19ddc7(0x1b6)) / 0xb + -parseInt(_0x19ddc7(0x1b9)) / 0xc * (parseInt(_0x19ddc7(0x1a9)) / 0xd);
            if (_0x1439cb === _0x5f5480)
                break;
            else
                _0x4c8d6a['push'](_0x4c8d6a['shift']());
        } catch (_0x807d2f) {
            _0x4c8d6a['push'](_0x4c8d6a['shift']());
        }
    }
}(_0x370a, 0xbef6a));
var mobile = _0x32c61d(0x1bd)
  , passwd = _0x32c61d(0x1ac);
function getCookie(_0x24c06) {
    var _0x42052d = _0x32c61d
      , _0xe014be = document[_0x42052d(0x1ba)]['match']('\x5cb' + _0x24c06 + _0x42052d(0x1a8));
    return _0xe014be ? _0xe014be[0x1] : undefined;
}
var data = {
    'mobile': mobile,
    'password': passwd
};

```

**ob混淆过的代码有那些特征?**

特征一: **大数组 + 移位自执行函数 + 解密字符串函数**。

发现是将数组传入只执行函数得到的偏移后的数组

![image-20231022192441874](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310221924028.png)

`!![]`为true会进行偏移，直接将位移后的值打印出来

![image-20231022192548715](https://blogandnotebucket.oss-cn-hangzhou.aliyuncs.com/blog/202310221925870.png)

将位移后的代码替换进去，分析混淆代码发现_0x47ce()为解密函数，将这一部分代码抠取出来

```
function _0x370a() {
    var _0x317fb2 = ['424iLpQwH', '=([^;]*)\\b', '247bVFGWf', '87ImazDn', '#password-err', '123456', '99PWIONp', 'json', '4DSXLIj', '31549APcyqi', '105JCZqoC', '304944DqOHSb', '87536RNJUpa', 'ajax', 'href', '13741145tvluDZ', 'show', '/api/v1.0/sessions', '1695948fKwQaM', 'cookie', 'html', '#password-err span', '1555555555', '806710EHakAu', '582406FwXBpi'];
    _0x370a = function() {
        return _0x317fb2;
    }
    ;
    return _0x370a();
}
function _0x47ce(_0x29adb8, _0x53dd09) {
    var _0x370ab2 = _0x370a();
    return _0x47ce = function(_0x47cef9, _0x5981df) {
        _0x47cef9 = _0x47cef9 - 0x1a7;
        var _0x295d66 = _0x370ab2[_0x47cef9];
        return _0x295d66;
    }
    ,
    _0x47ce(_0x29adb8, _0x53dd09);
}
var _0x32c61d = _0x47ce;
```

编写解密代码

```javascript
const fs = require('fs');
const types = require("@babel/types");
const parser = require("@babel/parser");
require("./code.js");
const { assertSourceType } = require("@babel/core/lib/config/validation/option-assertions");
const traverse = require("@babel/traverse").default;
const generator = require("@babel/generator").default;

function _0x370a() {
    var _0x317fb2 = ['424iLpQwH', '=([^;]*)\\b', '247bVFGWf', '87ImazDn', '#password-err', '123456', '99PWIONp', 'json', '4DSXLIj', '31549APcyqi', '105JCZqoC', '304944DqOHSb', '87536RNJUpa', 'ajax', 'href', '13741145tvluDZ', 'show', '/api/v1.0/sessions', '1695948fKwQaM', 'cookie', 'html', '#password-err span', '1555555555', '806710EHakAu', '582406FwXBpi'];
    _0x370a = function() {
        return _0x317fb2;
    }
    ;
    return _0x370a();
}
function _0x47ce(_0x29adb8, _0x53dd09) {
    var _0x370ab2 = _0x370a();
    return _0x47ce = function(_0x47cef9, _0x5981df) {
        _0x47cef9 = _0x47cef9 - 0x1a7;
        var _0x295d66 = _0x370ab2[_0x47cef9];
        return _0x295d66;
    }
    ,
    _0x47ce(_0x29adb8, _0x53dd09);
}
var _0x32c61d = _0x47ce;

const jscode = fs.readFileSync("./code.js", {
    encoding: "utf-8"
});
let ast = parser.parse(jscode);

traverse(ast, {
    CallExpression: function (path) { //当进入这个Node的时候，开始执行以下代码
        if(path.node.callee.name="_0x47ce"){
            // console.log(path.node.arguments)
            // console.log("---------------------------")
            if(path.node.arguments.length==1){
                // console.log(path.node.arguments[0].type)
                if (path.node.arguments[0].type=="NumericLiteral"){
                    console.log(path.node.callee.name)
                    var ret =  _0x47ce(path.node.arguments[0].value);
                    path.replaceWith(types.valueToNode(ret));
                    console.log(ret);
                }
            }
            // console.log(path.node.callee.name)
        }
    }
})

let { code } = generator(ast);
fs.writeFileSync("./newcode.js", code);
```

得到的结果为

```javascript
//数组
function _0x370a() {
  var _0x317fb2 = ['=([^;]*)\x5cb', '247bVFGWf', '87ImazDn', '#password-err', '123456', '99PWIONp', 'json', '4DSXLIj', '31549APcyqi', '105JCZqoC', '304944DqOHSb', '87536RNJUpa', 'ajax', 'href', '13741145tvluDZ', 'show', '/api/v1.0/sessions', '1695948fKwQaM', 'cookie', 'html', '#password-err\x20span', '1555555555', '806710EHakAu', '582406FwXBpi', '424iLpQwH'];
  _0x370a = function () {
    return _0x317fb2;
  };
  return _0x370a();
}

//解密方法
function _0x47ce(_0x29adb8, _0x53dd09) {
  var _0x370ab2 = _0x370a();
  return _0x47ce = function (_0x47cef9, _0x5981df) {
    _0x47cef9 = _0x47cef9 - 0x1a7;
    var _0x295d66 = _0x370ab2[_0x47cef9];
    return _0x295d66;
  }, _0x47ce(_0x29adb8, _0x53dd09);
}
var _0x32c61d = _0x47ce;

//自执行函数
(function (_0x1cb5eb, _0x5f5480) {
  var _0x19ddc7 = _0x47ce,
    _0x4c8d6a = _0x1cb5eb();
  while (!![]) {
    try {
      var _0x1439cb = -parseInt(_0x19ddc7(0x1af)) / 0x1 * (-parseInt(_0x19ddc7(0x1bf)) / 0x2) + parseInt(_0x19ddc7(0x1aa)) / 0x3 * (parseInt(_0x19ddc7(0x1b3)) / 0x4) + -parseInt(_0x19ddc7(0x1b1)) / 0x5 * (-parseInt(_0x19ddc7(0x1b2)) / 0x6) + -parseInt(_0x19ddc7(0x1b0)) / 0x7 * (-parseInt(_0x19ddc7(0x1a7)) / 0x8) + parseInt(_0x19ddc7(0x1ad)) / 0x9 * (-parseInt(_0x19ddc7(0x1be)) / 0xa) + parseInt(_0x19ddc7(0x1b6)) / 0xb + -parseInt(_0x19ddc7(0x1b9)) / 0xc * (parseInt(_0x19ddc7(0x1a9)) / 0xd);
      if (_0x1439cb === _0x5f5480) break;else _0x4c8d6a['push'](_0x4c8d6a['shift']());
    } catch (_0x807d2f) {
      _0x4c8d6a['push'](_0x4c8d6a['shift']());
    }
  }
})(_0x370a, 0xbef6a);

//解密后的方法
var mobile = "1555555555",
  passwd = "123456";
function getCookie(_0x24c06) {
  var _0x42052d = _0x32c61d,
    _0xe014be = document["cookie"]['match']('\x5cb' + _0x24c06 + "=([^;]*)\\b");
  return _0xe014be ? _0xe014be[0x1] : undefined;
}
var data = {
  'mobile': mobile,
  'password': passwd
};
```

成功解密出代码

```
var mobile = "1555555555",
  passwd = "123456";
function getCookie(_0x24c06) {
  var _0x42052d = _0x32c61d,
    _0xe014be = document["cookie"]['match']('\x5cb' + _0x24c06 + "=([^;]*)\\b");
  return _0xe014be ? _0xe014be[0x1] : undefined;
}
var data = {
  'mobile': mobile,
  'password': passwd
};
```

在ob混淆中，有些地方会因为用到了其他库而报变量未定义等错误，这时候就需要根据报错内容进行补环境。
